#!/bin/sh
# Parts adapted from https://hub.docker.com/r/maluuba/tomcat7/
if [ -d /deployment ];
then
	echo "Mapping deployed wars"
	rm -rf /var/lib/tomcat7/webapps
	ln -s /deployment /var/lib/tomcat7/webapps
fi
if [ -n "${JAVA_OPTS}" ];
then
	# Add any Java opts that are set in the container
	echo "Adding JAVA OPTS"
	echo "JAVA_OPTS=\"\${JAVA_OPTS} ${JAVA_OPTS} \"" >> /etc/default/tomcat7
fi
export CATALINA_OPTS="-Xdebug -Xrunjdwp:transport=dt_socket,address=8000,server=y,suspend=n"
chown tomcat7:tomcat7 /deployment
service tomcat7 restart

#Override the exit command to prevent accidental container distruction
echo 'alias exit="echo Are you sure? this will kill the container. use Ctrl + p, Ctrl + q to detach or ctrl + d to exit"' > ~/.bashrc

#Run bash to keep container running and provide interactive mode
bash
